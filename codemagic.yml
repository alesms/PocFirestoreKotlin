# Automatically generated on 2019-12-19 UTC from https://codemagic.io/app/5dfb57dcfd2c857c010371b5/settings
# Note that this configuration is not an exact match to UI settings. Review and adjust as necessary.

workflows:
  default-workflow:
    name: Default Workflow
    triggering:
    events:                # List the events that trigger builds
      - push
    branch_patterns:       # Include or exclude watched branches
      - pattern: '*'
        include: true
        source: true
    environment:
      vars:
        CM_KEYSTORE: Encrypted(Z0FBQUFBQmQtMXpuaXhrZi1FRWc2WFJiTXZkYW96UU1GLUNoNmhEd1pjYUVnOVBXUmpHam5XdFBJUDVBbXRwUlFzdlRNSU9lZ0RRMHF0emRJLVFfNlYxdmF5Wi1rZWhWRkhpMC1MNGpScDByWlhKSVFReGJDbW44VGhRT3E1MXRqcHZZSWN4OGc5cjNoSFhuYndNUy1ZNmViT1lOVExlNE1Wa2JjZGNXZ1lxSUQ3N3hJX2xGT0ZzZHdnZGJDZXJuMU1TME5uemFwVlBIbVpsUE9MdXowVW5wb3BjMUllZi1sX3Fjei1OYTk3dmFKMTVQdTUtTGpCekZqSURJQ3E0UHhuMmhlM2ZDQV84NVhZY1JzU2JsZEp4WHpMRXNuWFh0aW5EM3d3UF9Gd2NZZzlGcWtIRVVrR0pDb01mbjFvRnA5c01fN3dIekZucmZxamFWT3M4R3NqWVh6ZzNpeHczS0pxQXYxN0huUDQxVWU4eWFqaktEUWp5RW0xOUtmWnVid1lhZTFLTVUyQ18wVkc3eGpDUWF1akVSbEw1Nk9YcnI0SlVaWlI5T2VaYjk1cXdCTFB0Nm5hcnpHSUxpYlp5Zk5fdmg0dDdHRWthdDMycW92dTZBcXozOVZLRElUSnNJYUEtMUVWVjNXelpPMXE1Z01pMGZNMk0zazhEb2JwQTBKWENoTUJkNHFGcGVOTkZ5Z2hmcnVjWU1RcHdjZ1NaQzJQeDdqemRheWFpMnMyS19OUno3dW5Cazh5aDVRc2k2YzdBbGtzWTVINDhmVjMxQ3p2Vi11a196dGVqNV9CNXA4WUFzbTk4Sl8yUWdFNWp2aWhoNFgwMjE2aHdGT1IxMnJNQTB2MjZCd2F2N0tBZ2FCSTVJZ05DLXBUTjJKUEtnYmkxZ2J5VDZUel9oMG5NSlNoVF9LRHlyblpveTE1dWhfai1ZeE9FX2R3a1lfTWdUc2E4Skx1eHR2LUdjTjZBcm01cWJYTlBzekt2ZW12QmMwS0d0Vzc1OWVIeVJ3MXl3a0RZSXNTUVZNQ2xicmtWLUNNc2FuRkVBT0hnRDlqdkNXbUExZ3VsZ09GX2xYTDFZOW05akRvSlJLN0daRzhoR0pIU0xaMEZES3RTUXFyOFB2V3B5R2VtczlCdUNhalVhSmNEekVDNlR5bHJLZS1jUy1wRHZrT3ZzOVcxeGZGNzF6amNQeDJMdjgyXzZGZnJMUk9hVEw5QUs3aWpqRFlRLXBhaWxxdGhiV29hUEc1b3QxMmxyNjZUa3hlSzBnREs1VTlmQ3JtRDJjTEN0SFRMWUZ4SkV6TE5Fb3lybGNwR3c5emdDcnJTSHN3Z3R4VTV2N3NOQzhCM193Q0liVHgzTXlITTNrQ2J5UTFEclBGS193REh4Q3d6WnJ2WXhPUlkzeHMwZUJGZFdKa1N2V2FmRlFSTTVtSFJpc3lUZ3BpdWpfSE9mNFpGWFl6bEhERWJyd3g3UGY3QWhZSHhCWnZYckxHX1BLT2JpLUdZZTJ3ejAyTldfd3J5Nkh6QUlfZnJmR1VZM3kxeE00WVBBMzFHcUpIVmpUZmxYQ1M0YU9ESXRrREN6QXJZTDctb1o2bTl6cnFjRTVlZFMwb3I2NWJDZXN4SnQ0ZmNydHhQQzBvTU9lYzY5WFRnV3BYR3BTN1IyNXk3WUdNem14Tm80bk9wTjZFSEx4d2pqZHZXaHMxR3lVTmJDMGlfSkJVS0ZieG00NjVWRXB1SVBpcXVlbTJiWkJnazAtcnZNbEJaU3ByNlZlQ0hDZ0hPb0JiNE5KVXNOaFRKN0kxVU54MDVPT0phSEdPTHlSaklYVmdvcHgyOU1vbHZGWk5wOUVFR2NiMTlvbS0zU1VoODJ5bGprTVZmN1BNeUZnVnVkZHd1UHNfR0NUVERxRWY3ZXZnbEdkUTdsc0M3WTJsd3RPc3pMbmdCZEZzMkZaWVppcVF2cTB3bk5fd3dEMVIzeVlLcmFLbkNsYmtzTGl2ZFlHaWVUUnFXUlpEc2oyVlJ4RW1PSkVYaEUxeTZ4dzNEOHdEYTgzSVpUT09PUzNIeVFXMWw3UXc3ejdIS2Z6LW0xcF9EbG5PS0VDOVlxd1ZVU0hVU3MybG5OZ1FtZzgwU3g5STVqYzZfelROMG04cG5CbHo2NV94UGwtelBNbFVMNkJCMW44T3U0UTZ5VktlcHBSWWQ5QWVpSEVhMEh2ZFlCRDFYeTFpdnMxa1hqRkN1SWIyeXdKTmlvcWNkZkhtX1hkelBkQzJudVRMS2FnSmlzTV9iSGhYWnc3eUZXTWhUN29iMHp5b1UxWHBPeVloVG03Y3VJNjlkNEdEUm5nYzdjWE5ocFRtbWVkMUNZTkhjekRyUVY5eUt0elpIVlFwRjFNUlFld1ptcVAtWE5UaGd1LUR0enNjNkZRSVB5OFBMcmgtMzJvcU5OUjBRSEFzVE1UdXo4Z3hWQlpGUnBYemlCUmZmX3k3emo3dHVJZ1loSENjb2ZtT2NWZS1raUVxVmhVcE1kUDhMNVQ4QmxIcWdSd0dlSU9lYXBEWVNjVFlSZHpJcGxleWx2WVZtVlFyaXlYb1I1YWdISUJ1Mi1FZjhTOEllUk1jRzdocWxtRGptNjJHa3A4ZEFLaVByUDh4bXNLLUtVc0FmM0s4QWlNS1JNbS1adlhXQUJYMkVraWs3OXlFcElPQ2E1UEYxaTQwY3VGZ2xxdUtreFNxV3NDNVBmNTJiaTI1N0FQbWVmTXR1Rmp1QXJPZkloODFXM1g5QVZhZTlJVk4tNHAzR3NMTjM2MWVqV094NmdXOHVOckppQUJfY295dGRWa1VyMTRES1lxSTJSYWF2YXVoblBWTnllYzNWUlhLNUZjUWZWcFMzZVQ5V1M3MGtPa0JqZHFHRnJmOGUtOFhGcFpJN3ZwZ2dUSTI3TGEzUm81Z2xTNXVrMU5YSXNGSXhCZWEzNGtmQVJtRXJXaGxiZGFSaVBkeHZpaGVSVkRBdm80SGROb3M2cmxyRWlFVmhaNlZ4c2dGNnZuczg5cm9VcThCalN0ajlvRVNQOUxOTUdkZ0d4NkdvaGJ0eFVoMFktZDJDT0dpRlV0Q3FSUFhtWkNJN2ZXUDVOb3FiY19NbktYYXRhWk52cnV0UElOYXhtQlJBejdVTUpsT0xSYkZ4dklfbUphVUJWbzR1TTcwZ1BDVXFLZmtiOTAwbEt0dWptZk9ONFVZNE1Ub3lsM0lHZTc5QXNyaUJIWk4weENaQ2J5Y1d4WW5UcGNCMkIzemk1V1ctNUFSS1YzeExTVHU1NWpXMllMSG1KaGlQWjJmeEprdjRlTWtXV1cwd3dkazBHZ1FJVl9uQV9JN2ZlY0FiM2thSklWeno2dDFCWHR5ZnBQVnJsOUdUYTJtTjEtRmp4eUJaMXdITGV5bjk2cGdYUy11TmJXZmJTamxoOVl2bWJzd0hybDFIeDA4OGtqc2g3bzVqWnJ1NF8tT2xCajZxZmVpMkZUZUJFLWprdF9qQTVUZUtyVi1MNmFxV09KUHB5RmRCeTg2V2RmUG5ibjdyaUh5N1NFbjdVR0VjVG9sRjFCWkdoV1lDUmNwNE9ORkxUQS1TM2ludWJnVkllRTFldHAyT2NJMDRpNnVCb2MzWGdUUC1TOVRsQkVsbGxQYmpieHlURDhsY2M5X2ZZS1dIMllsNWNYQ1VEX0hlMnhucF9pSUNROXRFRllsdUE5OVduTHM2OHNhLTlUeV9TQzFDN29wR0UzYWNoQ19HYjhJc0RjQng0Z1VGNkp1dkJUckJPbHZNLXZzVm00aGdwMnQyVHctaURtMlhFRHc0NFNWSHVmYnJiQmRNWTdyblVIWWUycnJqMHJhSXIxc2dTQ2I5MHJBZ202eDNocktIY0ZXZXdIOHBlX3ItYUE0WXlTSnR1Wk1nQkJTOFVGeDV0Um1fZkphdElyQ1hwOTloRE9NRE1mWUZ6VUVlV0prSlJFTFQ4UlhzMlduQVU0cVl5b3BSLTg3YnlZRmgzbjVHMzFEUXdvUE13VUEwLVdQeXAxMEVQVEpVNFJKM3lzb1ZmR2tUM3RCSXUzeExmY1JnbXoyWFp5emVUNUpwMHpjMzRQZEN2b1UyUHFicTVycWRiRWdPR2JhQlJLYnVXRkNPY2xoWWhVSGhQTl9SOWNKSlJBaGNlaGZFVWMwTTJvWGlkVENwaTIwNXFEbTRTM1dkWm01RVplTW9mMWx5dlhqeHRucmM5T2Y0NGU4UVZfNmZIejYxWjMwaGVqUlZlNnVVVl9ubDFtTmY3Y2FxNjNSdGJvOUYtcGJjandfVm9RWHUxbnZoTk9ZSTZpRndueGRucGlIRHEwanVfZlg2TWtSZzhFYkRNbDJlNUdiaW9ZRkVndmk2ZmtLYlh4aWp0MElILXBkdzBNcUZBYXIxVHlSRWJ3WjV3UEtoQmpZMjVPaWZvenhHbXhmMzY0Q19pbko5R2lQTlFpVVdLbm9jcXYyMUoyMkZidzRQaGFzLVA2UFVibnNzam0zdUdhMG8yN2Rud3JCLWNha1lJRHdpN2JqaENMdEdjMGpNcGlHZFJTRVd6Ry1zVEJFdklIaW5pc1RNVWRmWTRzd29DT211N2phWUdwSFBHVVdLTFN2YnIyeGt4azNXVjY5Z0hpd2xVdEJnVHVKR0VCaWhabTV4N1U2RHZJa01ldnpFYjA4bXdxZ1FqRlR0dUxVVU5VNWN2MFFVZWNWNmVFSjJqRjd6cUFzMGJqdFRnem1kZ0NndTJ2ZW14d1BiOGtGd042M0JaUlplSFl0LUZFVkc5alFwUGViWFI2QnhrdFFPSmw1ZzVqbGlsZ1U3OEZ2TTZ6N3d6M2t2c2lQdHh2aWFVSlE3ZzVSTTducU9MNldTTjUzMUJOOWIzNzB3d05GazRuZHBaenJENFZRZkZLVjNzY2t0eWNkN1NpUGM5YjdoLVM1RzRoX0FYb2hKWmdiNzd6NmtWT29BN2ZndXdkUmFwVHFQY3hlbWY4OXIwSXJHOUppbzA5bWVlMlJUSURzUTh1ZU4ySEZCM2w5X0FEY1BMUldKeEZXVlNDVHFPZS1OUm8tc09paWtJbDVZY1VRPT0=)
        CM_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmQtMXpuVDhzZUhPNWNxX3otYU9fY3B1MHg3ZnV4WTBUa0M3NkpfVlp1bnAydTR6ZEdMZHhXU0pFVUd4bzY2SDBOM2J6OHFwVmpDZ2hBbkNBSjJXazJYNk50WFE9PQ==)
        CM_KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmQtMXpuQTB1cFpzYlhpbVBxUFRWRlcwck8tNE5ydUdYX0xlY3E3SHJhSFZ1aTVpN21ETkxTYmRQMHA4OW10UHB0S2JpOFpGeVdpZ0EtR0lxRDhNbkpZb0ZzUlE9PQ==)
        CM_KEY_ALIAS_USERNAME: Encrypted(Z0FBQUFBQmQtMXpuaWRhU0hpam9UYWZlckZHUVpLRzdtbU1pMFFWelJhVldpMkV3RGtzZkxPNnVWZHdValZ3MTZLblRvMGFDZzh5VDhYV1Bha2FZc1FYUU42M0lmUEdKU0E9PQ==)
    scripts:
      - |
        # set up key.properties
        echo $CM_KEYSTORE | base64 --decode > /tmp/keystore.keystore
        cat >> "$FCI_BUILD_DIR/android/key.properties" <<EOF
        storePassword=$CM_KEYSTORE_PASSWORD
        keyPassword=$CM_KEY_ALIAS_PASSWORD
        keyAlias=$CM_KEY_ALIAS_USERNAME
        storeFile=/tmp/keystore.keystore
        EOF
      - |
        # set up local properties
        echo "flutter.sdk=$HOME/programs/flutter" > "$FCI_BUILD_DIR/android/local.properties"
      - (echo y; echo y; echo y; echo y; echo y; echo y) | $ANDROID_HOME/tools/bin/sdkmanager --licenses
      - ./gradlew androidDependencies
      - ./gradlew clean assembleDebug --no-daemon --stacktrace
    artifacts:
      - build/**/outputs/**/*.apk
      - build/**/outputs/**/*.aab
      - build/**/outputs/**/mapping.txt
      - flutter_drive.log
    publishing:
      email:
        recipients:
          - vstrom79@gmail.com
      slack:
        channel: '#cicd_android'
        notify_on_build_start: false
